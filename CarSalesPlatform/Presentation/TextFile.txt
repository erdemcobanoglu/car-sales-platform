
Tamam — küçük bir proje için **tek proje (CarPlatform.Web)** ile, ama yine de düzenli kalacak şekilde ilerleyelim. Aşağıdaki yapı .NET 8 MVC + EF Core **Code First** için “minimum ama temiz” bir iskelet.

## 1) Klasör / Dosya Yapısı (tek proje)

```
CarPlatform.Web/
  Controllers/
    VehiclesController.cs
    LookupsController.cs            (opsiyonel: Make/Model/Trim dropdown için)
  Data/
    AppDbContext.cs
    Seed/
      DbSeeder.cs                   (opsiyonel ama önerilir)
    Migrations/                     (EF otomatik oluşturacak)
  Models/
    Vehicle.cs
    Make.cs
    VehicleModel.cs
    Trim.cs
    Enums/
      FuelType.cs
      TransmissionType.cs
      BodyType.cs
      MileageUnit.cs
  ViewModels/
    VehicleFormVm.cs
    VehicleFilterVm.cs              (opsiyonel)
  Views/
    Shared/
      _Layout.cshtml
      _ValidationScriptsPartial.cshtml
    Vehicles/
      Index.cshtml
      Details.cshtml
      Create.cshtml
      Edit.cshtml
  wwwroot/
  Program.cs
  appsettings.json
```

> “Models” klasörü içinde **Entities + Enums** tutuyoruz. “ViewModels” ile entity’leri UI’dan ayırıyoruz.

---

## 2) Modeller (Entities + Enums)

### `Models/Enums/FuelType.cs`

```csharp
namespace CarPlatform.Web.Models.Enums;
public enum FuelType { Petrol = 1, Diesel = 2, Hybrid = 3, PlugInHybrid = 4, Electric = 5, Other = 99 }
```

### `Models/Enums/TransmissionType.cs`

```csharp
namespace CarPlatform.Web.Models.Enums;
public enum TransmissionType { Manual = 1, Automatic = 2, SemiAutomatic = 3, CVT = 4, Other = 99 }
```

### `Models/Enums/BodyType.cs`

```csharp
namespace CarPlatform.Web.Models.Enums;
public enum BodyType { Sedan = 1, Hatchback = 2, SUV = 3, MPV = 4, Coupe = 5, Convertible = 6, Van = 7, Pickup = 8, Other = 99 }
```

### `Models/Enums/MileageUnit.cs`

```csharp
namespace CarPlatform.Web.Models.Enums;
public enum MileageUnit { Miles = 1, Kilometers = 2 }
```

### `Models/Make.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace CarPlatform.Web.Models;

public class Make
{
    public int Id { get; set; }

    [MaxLength(80)]
    public string Name { get; set; } = "";

    public ICollection<VehicleModel> Models { get; set; } = new List<VehicleModel>();
    public ICollection<Vehicle> Vehicles { get; set; } = new List<Vehicle>();
}
```

### `Models/VehicleModel.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace CarPlatform.Web.Models;

public class VehicleModel
{
    public int Id { get; set; }

    public int MakeId { get; set; }
    public Make Make { get; set; } = null!;

    [MaxLength(120)]
    public string Name { get; set; } = "";

    public ICollection<Trim> Trims { get; set; } = new List<Trim>();
    public ICollection<Vehicle> Vehicles { get; set; } = new List<Vehicle>();
}
```

### `Models/Trim.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace CarPlatform.Web.Models;

public class Trim
{
    public int Id { get; set; }

    public int ModelId { get; set; }
    public VehicleModel Model { get; set; } = null!;

    [MaxLength(120)]
    public string Name { get; set; } = "";   // Zetec

    [MaxLength(120)]
    public string? Level { get; set; }       // Base Trim

    public ICollection<Vehicle> Vehicles { get; set; } = new List<Vehicle>();
}
```

### `Models/Vehicle.cs`

```csharp
using System.ComponentModel.DataAnnotations;
using CarPlatform.Web.Models.Enums;

namespace CarPlatform.Web.Models;

public class Vehicle
{
    public int Id { get; set; }

    public int MakeId { get; set; }
    public Make Make { get; set; } = null!;

    public int ModelId { get; set; }
    public VehicleModel Model { get; set; } = null!;

    public int? TrimId { get; set; }
    public Trim? Trim { get; set; }

    public int Year { get; set; }
    public int Mileage { get; set; }
    public MileageUnit MileageUnit { get; set; } = MileageUnit.Miles;

    public double EngineLiters { get; set; }
    public FuelType FuelType { get; set; }
    public TransmissionType Transmission { get; set; }
    public BodyType BodyType { get; set; }

    public int Seats { get; set; }
    public int Doors { get; set; }

    [MaxLength(60)]
    public string Colour { get; set; } = "";

    public int TotalOwners { get; set; }
    public DateOnly? NctExpiry { get; set; }

    public DateTime CreatedAtUtc { get; set; } = DateTime.UtcNow;
    public DateTime? UpdatedAtUtc { get; set; }
}
```

---

## 3) DbContext (Code First)

### `Data/AppDbContext.cs`

```csharp
using CarPlatform.Web.Models;
using Microsoft.EntityFrameworkCore;

namespace CarPlatform.Web.Data;

public class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

    public DbSet<Vehicle> Vehicles => Set<Vehicle>();
    public DbSet<Make> Makes => Set<Make>();
    public DbSet<VehicleModel> Models => Set<VehicleModel>();
    public DbSet<Trim> Trims => Set<Trim>();

    protected override void OnModelCreating(ModelBuilder b)
    {
        base.OnModelCreating(b);

        b.Entity<Make>()
            .HasIndex(x => x.Name).IsUnique();

        b.Entity<VehicleModel>()
            .HasIndex(x => new { x.MakeId, x.Name }).IsUnique();

        b.Entity<Trim>()
            .HasIndex(x => new { x.ModelId, x.Name }).IsUnique();

        b.Entity<Vehicle>()
            .Property(x => x.EngineLiters)
            .HasPrecision(3, 1);

        b.Entity<Vehicle>()
            .HasOne(x => x.Make)
            .WithMany(x => x.Vehicles)
            .HasForeignKey(x => x.MakeId)
            .OnDelete(DeleteBehavior.Restrict);

        b.Entity<Vehicle>()
            .HasOne(x => x.Model)
            .WithMany(x => x.Vehicles)
            .HasForeignKey(x => x.ModelId)
            .OnDelete(DeleteBehavior.Restrict);

        b.Entity<Vehicle>()
            .HasOne(x => x.Trim)
            .WithMany(x => x.Vehicles)
            .HasForeignKey(x => x.TrimId)
            .OnDelete(DeleteBehavior.SetNull);
    }
}
```

---

## 4) ViewModel (Create/Edit için)

### `ViewModels/VehicleFormVm.cs`

```csharp
using System.ComponentModel.DataAnnotations;
using CarPlatform.Web.Models.Enums;

namespace CarPlatform.Web.ViewModels;

public class VehicleFormVm
{
    public int? Id { get; set; }

    [Required] public int MakeId { get; set; }
    [Required] public int ModelId { get; set; }
    public int? TrimId { get; set; }

    [Range(1950, 2100)] public int Year { get; set; }
    [Range(0, 2_000_000)] public int Mileage { get; set; }
    public MileageUnit MileageUnit { get; set; } = MileageUnit.Miles;

    [Range(0.5, 10.0)] public double EngineLiters { get; set; }
    public FuelType FuelType { get; set; }
    public TransmissionType Transmission { get; set; }
    public BodyType BodyType { get; set; }

    [Range(1, 12)] public int Seats { get; set; }
    [Range(1, 10)] public int Doors { get; set; }

    [MaxLength(60)] public string Colour { get; set; } = "";

    [Range(0, 50)] public int TotalOwners { get; set; }
    public DateOnly? NctExpiry { get; set; }
}
```

---

## 5) Program.cs (EF Core + MVC + Seed)

### `Program.cs`

```csharp
using CarPlatform.Web.Data;
using CarPlatform.Web.Data.Seed;
using Microsoft.EntityFrameworkCore;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllersWithViews();

builder.Services.AddDbContext<AppDbContext>(opt =>
    opt.UseSqlServer(builder.Configuration.GetConnectionString("Default")));

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Home/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();

app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Vehicles}/{action=Index}/{id?}");

// otomatik migrate + seed (küçük projede pratik)
using (var scope = app.Services.CreateScope())
{
    var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
    db.Database.Migrate();
    await DbSeeder.SeedAsync(db);
}

app.Run();
```

### `appsettings.json`

```json
{
  "ConnectionStrings": {
    "Default": "Server=(localdb)\\MSSQLLocalDB;Database=CarPlatformDb;Trusted_Connection=True;MultipleActiveResultSets=true"
  },
  "Logging": {
    "LogLevel": { "Default": "Information", "Microsoft.AspNetCore": "Warning" }
  },
  "AllowedHosts": "*"
}
```

---

## 6) Seed (Make/Model/Trim örnek veri)

### `Data/Seed/DbSeeder.cs`

```csharp
using CarPlatform.Web.Models;
using Microsoft.EntityFrameworkCore;

namespace CarPlatform.Web.Data.Seed;

public static class DbSeeder
{
    public static async Task SeedAsync(AppDbContext db)
    {
        if (await db.Makes.AnyAsync()) return;

        var ford = new Make { Name = "Ford" };
        var smax = new VehicleModel { Name = "S-Max", Make = ford };
        var zetec = new Trim { Name = "Zetec", Level = "Base Trim", Model = smax };

        db.Makes.Add(ford);
        db.Models.Add(smax);
        db.Trims.Add(zetec);

        await db.SaveChangesAsync();
    }
}
```

---

## 7) NuGet + Migration Komutları

Paketler:

* `Microsoft.EntityFrameworkCore.SqlServer`
* `Microsoft.EntityFrameworkCore.Tools`

Komutlar:

```bash
dotnet ef migrations add InitialCreate
dotnet ef database update
```

---

## Sonraki Adım (hemen yazabiliriz)

Bu iskeletin üstüne sırayla:

1. `VehiclesController` (Index/Details/Create/Edit)
2. Create/Edit sayfalarında Make/Model/Trim dropdown
3. Model dropdown’u Make’e göre filtreleme (LookupsController + küçük JS)

İstersen ben bir sonraki mesajda **VehiclesController + Create/Edit/Index Razor View** dosyalarını komple (kopyala-yapıştır) çıkarayım.


 
=====  add migration  ===== 

1) EntityFrameworkCore\Add-Migration InitialCreate
2) EntityFrameworkCore\Update-Database


=====  add migration  ===== 